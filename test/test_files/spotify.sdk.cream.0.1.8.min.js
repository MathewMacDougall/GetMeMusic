!function(a,b){"use strict";var c=function(a){return a=a.replace(/[^\/]*$/,""),a.substring(0,a.length-1)},d=c(location.pathname);window.process={cwd:function(){return d||"/"}};for(var e={},f=function(a){var g=e[a];if(!g){var h=b[a];if(!h)throw new Error("module "+a+" not found");var i=c(a),j={};g=j.exports={};var k=d+"/"+a,l=i?d+"/"+i:process.cwd();h.call(g,f,j,g,window,k,l),g=e[a]=j.exports}return g},g=0;g<a.length;g++)f(a[g])}(["src/builder.js"],{"src/sourcetype.js":function(a,b,c,d,e,f){var g={INTERNAL:"INTERNAL",DFP:"DFP"};b.exports=g},"src/protobufschemas.js":function(a,b,c,d,e,f){var g={lasertag:[{name:"AdTagResponse",fields:[{id:1,type:"string",name:"ppid",enumMap:null},{id:2,type:"int64",name:"ttl",enumMap:null},{id:3,type:"*AdTagKeyValue",name:"keyValues",typeName:"AdTagKeyValue",enumMap:null},{id:4,type:"int32",name:"streamTimeBetweenAdBreaks",enumMap:null},{id:5,type:"*string",name:"targetedPlaylist",enumMap:null}]},{name:"AdTagKeyValue",fields:[{id:1,type:"string",name:"key",enumMap:null},{id:2,type:"string",name:"value",enumMap:null}]}]};b.exports=g},"src/inventorytype.js":function(a,b,c,d,e,f){var g,h,i={LEADERBOARD:{id:"leaderboard",refresh:!0,sizes:[[728,90]],adChooserBannerType:"full banner"},BILLBOARD:{id:"billboard",sizes:[[970,250]]},HPTO:{id:"hpto",sizes:[[1200,270]]},AUDIO:{id:"audio",sizes:[[2,2]],companionSizes:[[301,301]]}},j={};for(g in i)i.hasOwnProperty(g)&&(h=i[g],h.key=g,j[h.id]=h);c.InventoryType=i,c.InventoryTypeById=j},"src/events.js":function(a,b,c,d,e,f){var g=function(){var a={AD_AVAILABLE:"AD_AVAILABLE",AD_BREAK_CHANGED:"AD_BREAK_CHANGED",AD_BREAK_ENDED:"AD_BREAK_ENDED",AD_BREAK_STARTED:"AD_BREAK_STARTED",AD_CLEAR:"AD_CLEAR",AD_DEBUG:"AD_DEBUG",AD_NOT_AVAILABLE:"AD_NOT_AVAILABLE",AD_RECEIVED:"AD_RECEIVED"};return a};b.exports=g},"src/parsers.js":function(a,b,c,d,e,f){var g=function(){this.toTrackMetadata=function(a){var b={__pid:a.file_id,name:a.title,disc:1,duration:parseInt(1e3*a.duration,10),number:1,popularity:a.tracking_url,availability:"available",playable:!0,explicit:!1,image:Spotify.SourceURLs.normal+a.image_id,starred:!1,advertisement:!0,ad_metadata:{type:a.ad_type,embed:{width:a.embed?a.embed.width:100,height:a.embed?a.embed.height:100,background_image:a.embed?Spotify.SourceURLs.original+a.embed.background_image:""},targetUrl:a.target_url},artists:[{uri:a.target_url,name:a.advertiser}]};return b}},h=function(){var a=Spotify.DebuggerJS,b=function(){a.error("Spotify.Parsers.AdChooser",[].slice.apply(arguments),"corejs")};this.parseServerResponse=function(a){return a=Spotify.Utils.convertStringToXML(a),Spotify.Utils.convertXMLToJSON(a.documentElement)},this.parseAdEntryVersion1=function(a,b,c,d){var e=null;"string"==typeof a.html?e=a.html:"object"==typeof a.html&&"string"==typeof a.html["#cdata-section"]&&(e=a.html["#cdata-section"]);var f={ad_type:b,has_been_played:!1,has_been_clicked:!1,adPlayCount:0,campaignPlayCount:0,ids_valid:!0,non_explicit:a["non-explicit-only"]||0,is_test_ad:!1,priority:parseFloat(a.priority),duration:parseInt(a.duration,10),min_duration:0,ad_version:a.ad_version||1,start_time_earliest:parseInt(a.starttime),start_time_latest:parseInt(a.endtime),campaign_expiry:parseInt(a.expiry),adclass:0,adkind:null,adchooserkind:null,rules:d,ad_id:a.id,campaign_id:a.campaign,advertiser:a.advertiser,target_url:a.url,token:a.token,tracking_url:"string"==typeof a["tracking-url"]?a["tracking-url"]:null,files:a.files,image_id:a.image,embed:{width:a["embed-width"],height:a["embed-height"],background_image:"string"==typeof a["embed-background-image"]?a["embed-background-image"]:""},banner_size:null,banner_type:"string"==typeof a["banner-type"]?a["banner-type"]:null,banner_mode:"string"==typeof a["banner-mode"]?a["banner-mode"]:null,html:e,title:"string"==typeof a.title?a.title:null,caption:"string"==typeof a.caption?a.caption:null,file_id:c,large_bgcolor:null,large_image_id:null,fullscreen_delay:null,fullscreen_inactivity_timeout:null,background_target_url:null,message:null,level:null};return"audio"===b&&(f.adkind="ENC_AD_AUDIO"),f},this.parseAudioAdsVersion1=function(a,b){return this.parseAdsVersion1(a,"audio")},this.parseBannerAdRpcResponse=function(a){return this.parseAdsVersion1(this.parseServerResponse(a.response),"banner")},this.parseBannerAdHermesResponse=function(a){if(!a||!a[0])return b("no response frame from hermes request"),!1;var c,d,e,f,g,h,i,j,k=a[0],l={AdQueueEntry:[]};if(!k.adQueueEntry||0===k.adQueueEntry.length)return b("empty ad queue response"),!1;for(c=0,d=k.adQueueEntry.length;d>c;c++){for(i=k.adQueueEntry[c],j={ad_version:i.version,"tracking-url":i.tracking_url,priority:i.priority,duration:i.duration,starttime:i.start_time,endtime:i.end_time,expiry:i.expiry,html:i.html,id:i.id,campaign:i.campaign,advertiser:i.advertiser,url:i.url,token:i.token,image:i.image,"banner-type":i.banner_type},i.rule=i.rule||[],g=[],e=0,f=i.rule.length;f>e;e++)h=i.rule[e],g.push({type:h.type,interval:h.interval,times:h.times});l.AdQueueEntry.push(this.parseAdEntryVersion1(j,"banner",null,g))}return l},this.parseAdsVersion1=function(a,c){var d={AdQueueEntry:[]};"audio"===c&&(d["audio-ad-break"]={});var e,f={};try{if("undefined"!=typeof a.rules.rule)for(var g=0,h=a.rules.rule.length;h>g;g+=1)e=a.rules.rule[g],f[e.id]=e;"audio"===c&&(d["audio-ad-break"]=a["audio-ad-break"]);var i;if("audio"===c?i=a.ads["audio-ad"]:"banner"===c&&(i=a.ads["banner-ad"]),i){var j=[];i.length>0?j=i:"undefined"!==i.ad_version&&(j=[i]);for(var k=0,l=j.length;l>k;k+=1){for(var m=j[k],n=[],o=0,p=m.rules.id.length;p>o;o+=1)e=m.rules.id[o],n.push(f[e]);var q=null;if("audio"===c)for(var r=0,s=m.files.file.length;s>r;r+=1){var t=m.files.file[r];if(t["@attributes"]&&"MPEG 1 layer 3,160000,0,1,1"===t["@attributes"].format){q=t["@attributes"].id;break}}var u=c;"audio"===u&&(u="string"==typeof m["embed-width"]?"lightbox":"audio");var v=this.parseAdEntryVersion1(m,u,q,n);d.AdQueueEntry.push(v)}}}catch(w){b(w)}return d}};c.AdMetadataParser=g,c.AdChooserParser=h},"src/legacy/adchooser.js":function(a,b,c,d,e,f){var g=a("src/parsers.js").AdChooserParser,h=a("src/parsers.js").AdMetadataParser;b.exports=function(){Spotify.EventTarget.call(this);var a,b,c,d=Spotify.DebuggerJS,e=this,f=new g,i=new h,j=new Spotify.Events,k=[],l=[],m=0,n="streamTimeSinceLastAdBreak",o=null,p="ads",q="get_ad",r="time",s=1020,t=600,u=3600,v=600,w=3600,x=[0,60],y=35,z="defaultAdBreakLength",A=0,B="audioAdBreakAvailableTime",C=0,D=0,E=600,F="timeBetweenAdBreak",G=0,H=[],I=[],J=[],K={},L="adHistory",M=[],N=null,O=null,P=!1,Q=!1,R=!1,S=!0,T="hm://ad-hermes-proxy/adqueue",U="ADQUEUE",V=["has_been_played","has_been_clicked","has_been_rendered","adPlayCount","campaignPlayCount"],W=3,X={},Y=0,Z="timeOfLastAdBreak";this.serviceIsReady=!1;var $=function(a){var b=["Domain: "+a.domain,"Code: "+a.code,"Description: "+JSON.stringify(a.description),"Data: "+JSON.stringify(a.data)];d.error("Spotify.Services.AdChooser",["AdChooser Error.. "+b.join(",")],"corejs")},_=function(a,b){b&&b.stack&&(a+="\n Stack: "+JSON.stringify(b.stack)),$(new Spotify.Errors.Error([Spotify.Errors.Codes.ADS_ERROR,Spotify.Errors.Codes.ADS_SERVER_ERROR,a,{extra:b}]))},aa=function(){d.log("Spotify.Services.AdChooser",[].slice.apply(arguments),"corejs")},ba=function(a,c,d){try{var e={source:"Ads.Core",context:"Spotify.Services.AdChooser",event:a,event_version:c,source_version:"0.0.1",source_vendor:"ads",data:"undefined"!=typeof d?JSON.stringify(d):""};b.logClientEvent(e,function(){aa("Logged Client Event",e)})}catch(f){_("Could not logClientEvent",f)}},ca=function(){return[{name:"audio",queue:H},{name:"banner",queue:I}]},da=function(a,b){a.push(b.ad_id),ea(b)},ea=function(a){"undefined"==typeof K[a.ad_id]&&Ma(a);var b=Ha(a.ad_id);if(b)for(var c=0,d=V.length;d>c;c++)a[V[c]]=b[V[c]];K[a.ad_id].entry=a},fa=function(a,b,c,d){var f=new Spotify.Calls.Simple({method:a,payload:b,context:e},c,d);e.send(f)},ga=function(a,b){if("function"==typeof a&&"function"==typeof b){var c=1,d=1,f=ha(I);if(Q){var g=[c,d,f.length];e._bannerAvoid=f,g.push.apply(g,f),aa("Retrieving Banner Ads",p,g);try{fa(p,g,function(b){a(b,"rpc")},b)}catch(h){Ba({serverError:!0,banner:!0}),_("Exception thrown communicating with ad server",h)}}else ia({type:"leaderboard",avoidAds:f},function(b){a(b,"hermes")},function(a){_("Hermes leaderboard call failed",a),b(a)})}else _("Invalid callbacks specified for _retrieveBannerAdsFromServer")},ha=function(a){var b,c,d=[],f={};for(b=0,c=M.length;c>b;b++)d.push(M[b]),f[M[b]]=!0;if(a)for(b=0,c=a.length;c>b;b++)f[a[b]]||(d.push(a[b]),f[a[b]]=!0);var g=a===I?"banner":"audio";La(function(a){f[a.ad_id]||Ea(a)||(d.push(a.ad_id),f[a.ad_id]=!0)},g);var h;return d.length>s&&(h=d.length-s,d=d.slice(h,d.length)),e._avoidAdsList=d,d},ia=function(a,b,d){a.client_language=c.preferred_locale||"en",a.product=c.product,a.type=a.type||"leaderboard",a.version=1,P&&delete a.avoidAds;var f=new Spotify.Calls.Hermes({header:{uri:T,method:"GET"},payload:[a],payloadSchemas:["ad-hermes-proxy#AdRequest"],responseSchemas:["ad-hermes-proxy#AdQueueResponse"],type:U},b,d);return aa("_sendAdHermesCall",a),e.send(f)},ja=function(a,b){var c=null;return Ba({banner:!0}),"rpc"===b?c=f.parseBannerAdRpcResponse(a):(aa("ad-chooser-proxy responded"),c=f.parseBannerAdHermesResponse(a)),ka(c)},ka=function(a){var b=null,c=null,d=null,e=null,f=[],g=[],h=[];if(a.AdQueueEntry&&a.AdQueueEntry.length){for(b=0,c=a.AdQueueEntry.length;c>b;b++)d=a.AdQueueEntry[b],e=d.ad_id,f.push(e),"tower"===d.banner_type?(wa(e),h.push(e)):(da(I,d),g.push(e));va(I)}J=g},la=function(){I=[],ga(ja,function(a){_("Could not retrieve banner ads in resetBannerQueue",a)})},ma=function(a,b){if("function"!=typeof a||"function"!=typeof b)return void _("Invalid callbacks specified for _retrieveAudioAdsFromServer");var c=0,d=1,e=ha(H),f=[c,d,e.length];f.push.apply(f,e),aa("Retrieving Audio Ads",p,f);try{fa(p,f,a,b)}catch(g){Ba({serverError:!0}),_("Exception thrown communicating with ad server",g)}},na=function(a){var b=null;return Ba(),qa(),b=f.parseServerResponse(a.response),ua(b)},oa=function(a,b,c){if("function"==typeof b&&"function"==typeof c){var d=[a];try{fa(q,d,b,c)}catch(e){_("Exception thrown communicating with ad metadata server",e)}}else _("Invalid callbacks specified for _retrievedMetadataFromServer")},pa=function(a){var b=f.parseServerResponse(a.response);return b},qa=function(){ra(function(a){sa(a.response)},function(a){$(new Spotify.Errors.Error([Spotify.Errors.Codes.ADS_ERROR,Spotify.Errors.Codes.ADS_SERVER_ERROR,"Exception thrown retrieving server time",{extra:a}]))})},ra=function(a,b){"function"==typeof a&&"function"==typeof b?fa(r,[0],a,b):_("Invalid callbacks for retrieveAdServerTime")},sa=function(a){if(parseInt(a,10)>0){var b=Aa();G=b-a}else _("Invalid server time specified")},ta=function(){return Aa()+G},ua=function(a){var b=0|parseInt(a["@attributes"].version,10),c=null,d=null,g=null,h=[],i=null,j=null;if(0===b)return void _("Missing version attribute from audio queue data structure");if(c=f["parseAudioAdsVersion"+b].bind(f),"function"==typeof c){for(g=c(a),xa(parseInt(g["audio-ad-break"].length,10)),ya(parseInt(g["audio-ad-break"].time_between,10)),i=0,j=g.AdQueueEntry.length;j>i;i+=1)d=g.AdQueueEntry[i],e._avoidAdsList&&e._avoidAdsList.indexOf(d.ad_id)>=0&&h.push(d.ad_id),da(H,d);va(H),h.length&&aa("Avoided ads included in response",h.length,h),e.getNextAd()}else _("No parser exists for audio queue version "+b)},va=function(a,b){try{a.sort("undefined"==typeof b?function(a,b){return K[b].entry.priority-K[a].entry.priority}:b)}catch(c){_("Unable to prioritize ad queue",c)}},wa=function(a){try{M.length>=s&&(M=M.slice(1+M.length-s,M.length)),M.push(a)}catch(b){_("Unable to add forbidden ad",b)}},xa=function(a){try{y=a,O.setItem(z,y)}catch(b){_("Unable to set audio ad break length",b)}},ya=function(a){try{E=a,O.setItem(F,E)}catch(b){_("Unable to set audio ad break time between",b)}},za=function(a){try{A+=a,A>2*y&&(A=2*y),O.setItem(B,A)}catch(b){_("Unable to set audio ad break available time",b)}},Aa=function(){return Math.round((new Date).getTime()/1e3)},Ba=function(a){var b=!1,c=!1,d=Aa(),e=null,f=Math.floor(Math.random()*x[1]+x[0]);"undefined"!=typeof a&&(a.serverError===!0&&(b=!0),a.banner===!0&&(c=!0)),c?(e=b===!1?v:w,D=d+e+f):(e=b===!1?t:u,C=d+e+f)},Ca=function(){null!==O.getItem(F)&&(E=parseInt(O.getItem(F),10)),null!==O.getItem(z)&&(y=parseInt(O.getItem(z),10)),null!==O.getItem(n)&&(m=parseInt(O.getItem(n),10)),null!==O.getItem(L)&&(K=JSON.parse(O.getItem(L)),"object"!=typeof K&&(K={})),null!==O.getItem(Z)&&(Y=parseInt(O.getItem(Y),10))},Da=function(){var a,b=Object.keys(K);try{for(var c=0,d=b.length;d>c;c++)a=K[b[c]],a&&a.expiry_time<=ta()&&(a.event_history=[],a.start_time_latest<=ta()&&delete K[b[c]]);return Ka(),!0}catch(e){_("Unable to purge expired ad history",e)}},Ea=function(a){var b=null,c=null,d=null,e=[],f=K[a.ad_id],g=ta(),h={max_campaign_repeats_within:function(b,c){var d=g-b,e=[],f=a.campaign_id,h=null,i=function(a){"impression"===a.event&&a.timestamp>=d&&e.push(a)};for(h in K)K.hasOwnProperty(h)&&K[h].campaign_id===f&&K[h].event_history.map(i);return e.length<c},max_repeats_within:function(a,b){var c=g-a,d=[];return f.event_history.map(function(a){"impression"===a.event&&a.timestamp>=c&&d.push(a)}),d.length<b},max_attempts_within:function(a,b){var c=g-a,d=[];return f.event_history.map(function(a){"attempt"===a.event&&a.timestamp>=c&&d.push(a)}),d.length<b},max_clicks_within:function(a,b){var c=g-a,d=[];return f.event_history.map(function(a){"click"===a.event&&a.timestamp>=c&&d.push(a)}),d.length<b}};if(f.entry.rules.length>0)for(b in f.entry.rules)f.entry.rules.hasOwnProperty(b)&&(c=f.entry.rules[b],d=h[c.type](parseInt(c.interval,10),parseInt(c.times,10)),e.push(d));return-1===e.indexOf(!1)},Fa=function(a){try{var b=[],c=null,d=0,e=0,f=null,g=null,h=ca();for(aa("clear invalid ads in queue"),d=0,e=h.length;e>d;d++)if(a===h[d].queue){for(b=[],f=0,g=a.length;g>f;f+=1)c=Ha(a[f]),c.start_time_latest<=ta()?(aa("Removing expired ad",c.ad_id),wa(c.ad_id)):b.push(c.ad_id);for(a.splice(0,a.length),f=0;f<b.length;f++)a.push(b[f]);break}}catch(i){_("Unable to clear invalid ads in ad queue",i)}},Ga=function(a){var b=a.split("spotify:ad:")[1];return Ya(b)},Ha=function(a){return K[a]&&K[a].entry?K[a].entry:null},Ia=function(){var a=[],b=null,c=null,d=[];for(Fa(H),va(H);b=H.shift();)if(c=Ha(b),c&&Ea(c))if(c.duration<=A){if(a.push(c),za(-1*c.duration),0>=A)break}else d.unshift(b);for(;b=d.shift();)H.unshift(b);return H.length<W&&e.maybeRetrieveAudioAds(),a},Ja=function(){var a=null,b=null,c=null;for(Fa(I),va(I);b=I.shift();)if(c=Ha(b),c&&(P||Ea(c))){a=c;break}return I.length<W&&e.maybeRetrieveBannerAds(),a},Ka=function(){O.setItem(L,JSON.stringify(K))},La=function(a,b){var c,d;for(c in K)if(K.hasOwnProperty(c)&&(d=K[c].entry,d&&(!b||d.ad_type===b)&&a(d)===X))break},Ma=function(a){K[a.ad_id]={campaign_id:a.campaign_id,expiry_time:a.campaign_expiry,rules:a.rules,event_history:[],entry:a}},Na=function(a,b){var c=Ha(a);null!==c?("undefined"!=typeof b&&K[a].event_history.push({timestamp:ta(),event:b}),Ka()):_("Unable to locate ad queue entry")},Oa=function(a){var b,c,d,e=null;if(K[a])for(e={},b=0,c=K[a].event_history.length;c>b;b++)d=K[a].event_history[b],e[d.event]=e[d.event]||[],e[d.event].push(d.timestamp);return e},Pa=function(a,b){var c,d,e,f=[];if(K[a]){for(c=0,d=K[a].event_history.length;d>c;c++)e=K[a].event_history[c],"*"!==b&&e.event!==b&&f.push(e);K[a].event_history=f,Ka()}},Qa=function(a,b){var c=Ga(a);return null===c?void _("Unable to locate ad to record ad event: "+a):void Ra(c.ad_id,b)},Ra=function(a,b){var c=Ha(a),d=!1;if(!c)return _("ad entry not found",a),!1;switch(d=!0,b){case"click":c.has_been_clicked=!0,Na(a,"click");break;case"attempt":Na(a,"attempt");break;case"render":c.has_been_rendered=!0,Na(a,"render");break;case"impression":c.has_been_played=!0,c.adPlayCount+=1,La(function(a){a.campaign_id===c.campaign_id&&(a.campaignPlayCount+=1)}),Na(a,"impression");break;case"error":Na(a,"error");break;default:_("Invalid ad event",b),d=!1}return d},Sa=function(a){Qa(a.params.adUri,a.params.type)},Ta=function(){ba("_onAdEnded","call",m),m=0,O.setItem(n,m),ba("_onAdEnded","persistedStreamTime",m),O.setItem(Z,Y),e.trigger(j.AD_BREAK_ENDED),ba("_onAdEnded","triggered:AD_BREAK_ENDED")},Ua=function(a){var b={playerId:a.id,active:!1,interval:null,start:function(){S&&!b.active&&(b.active=!0,b.interval=setInterval(function(){S&&a.isPlaying===!0&&a.isAd===!1&&(m++,m%10===0&&(O.setItem(n,m),aa("Stream time: ",m),e.getNextAd()))},1e3))},stop:function(){b.active&&(b.active=!1,clearInterval(b.interval))}};return a.bind(j.PLAYING,b.start),a.bind(j.PAUSED,b.stop),b},Va=function(b){var c=a.getPlayerById(b.params.id);Wa(c)},Wa=function(a){l.push(a);var b=Ua(a);k.push(b),aa("player added",a.id)},Xa=function(a){try{Y=Date.now(),e.trigger(a.type,a.params),e.trigger(j.AD_BREAK_STARTED),ba("getNextAd","triggered:AD_BREAK_STARTED")}catch(b){_("Error on triggering interception events.",b)}},Ya=function(a){{var b=null;ca()}return aa("lookupAdByFileId",a),La(function(c){return b||c.file_id!==a?void 0:(b=c,X)}),b};this._setDebugNoBannerRules=function(a){P=!!a},this._setDebugBannerRpc=function(a){Q=!!a},this._lookupQueueEntry=function(a,b,c,d){if(!c||!d)return void _("_lookupQueueEntry: success and fail callbacks are required");var e=!1,g=Ha(b);g&&e?c(g):oa(b,function(b){var e=pa(b),g=0|parseInt(e["@attributes"].version,10),h=f["parseAdsVersion"+g].bind(f);try{var i=h(e,a===H?"audio":"banner");if(!(i&&i.AdQueueEntry&&i.AdQueueEntry[0]))throw new Error("No AdQueueEntry in response");ea(i.AdQueueEntry[0]),c(i.AdQueueEntry[0])}catch(j){d(j)}},function(a){d(a)})},this._lookupAndAppendQueueEntry=function(a,b,c,d,e,f){return c&&d?void this._lookupQueueEntry(a,b,function(b){e>0&&(b.start_time_earliest=e),f>0&&(b.start_time_latest=f),da(a,b),c()},function(a){d(a)}):void _("success and fail callbacks are required")},this._defineQueue=function(a,b,c){"string"==typeof a&&(a="banner"===a?I:"audio"===a?H:null),void 0===c&&(c=!0),a===I?a=I=[]:a===H?a=H=[]:_("First parameter to _defineQueue must be an internal queue array reference, or the strings 'audio' or 'banner'");var d=function(){var f=b.shift();if(f){c&&Pa(f,"*");var g=null,h=null;c&&(g=Date.now()/1e3-604800,h=Date.now()/1e3+604800),e._lookupAndAppendQueueEntry(a,f,d,function(){_("Could not retrieve ad: "+f),d()},g,h)}};d()},this.onReady=function(a,b){this.serviceIsReady?a.call(b):this.bind(j.READY,a,b)},this.recordAdEvent=function(a,b){Qa(a,b)},this.recordAdEventById=function(a,b){return!!Ra(a,b)},this.getBannerAd=function(){Da(),d.log("Spotify.Services.AdChooser",["Fetching banner ad"],"corejs");var a=Ja();return a&&d.log("Spotify.Services.AdChooser",["Found banner ad",a],"corejs"),a||null},this.recordImpression=function(a,c,d){var e=Ha(a);if(!e)return void _("attempt to log banner shown on unqueued ad: "+a);var f=Oa(a),g=0,h=0;if(f&&f.render||d){if(!d){if(Ra(a,"impression"),e.tracking_url&&"undefined"!=typeof Image){var i=new Image;i.src=e.tracking_url.replace(/\[(timestamp|ord|cachebuster)\]/i,Date.now())}g=f.render[f.render.length-1],h=Date.now()/1e3-g,1>h&&(h=1)}void 0===d&&(d="");var j={ad_id:a,campaign_id:e.campaign_id,token:e.token,time_started:g,ad_clicked:c||!!f.click&&f.click.length&&f.click[f.click.length-1]>=g,client_ad_count:e.adPlayCount,client_campaign_count:e.campaignPlayCount,duration:Math.floor(h),error:d};aa("recordImpression:logEntry",j),b.logBannerShown(j),Pa(a,"click")}else _(f?"render event was not found in ad history for: "+a:"ad history not found for: "+a)},this.getNextAd=function(){var a=null,b=null;S&&(Da(),aa("getNextAd",m,E),N&&!e._checkAd&&m>=E?(e._checkAd=!0,N.getLength().then(function(c){if(e._checkAd=!1,aa("adContext.getLength()",c),0===c&&(aa("canInjectAd"),za(y),a=Ia(),a.length>0)){ba("getNextAd","willInject",a[0].file_id),ba("getNextAd","streamTimeSinceLastAdBreak",m),aa("Injecting ad!",a[0]),b=i.toTrackMetadata(a[0]),aa("Track Meta",b),b.uri=b.playableURI=Spotify.Link.adLink(b.__pid).toURI();for(var d=0,f=l.length;f>d;d++)l[d].ad=a[0];var g=N.createMutator();g.add([b]),g.apply(),ba("getNextAd","injected",{file_id:a[0].file_id,ad_id:a[0].ad_id}),N.setOwner(b.artists[0].uri)}},function(a){_("cannot retrieve context length",a)})):aa(E-m+" seconds of streaming left until ad can play..."))},this.lookup=function(a,b,c){var d=[],e=null,g=null;Spotify.Utils.isArray(a)&&1===a.length?(g=Spotify.Link.fromString(a[0]),e=Ya(g.id),null!==e?(d.push(i.toTrackMetadata(e)),b(d,200)):oa(g.id,function(a){var c=pa(a),e=0|parseInt(c["@attributes"].version,10),g=f["parseAudioAdsVersion"+e].bind(f),h=g(c);console.log("response",h);var j=i.toTrackMetadata(h.AdQueueEntry[0]);console.log("adBreakMeta",j),j.playableURI=Spotify.Link.adLink(j.__pid),j.uri=j.playableURI.toURI(),d.push(j),b(d,200)},function(a){_(a)})):_("Array (first parameter) does not contain any items!")},this.lookupAdEntry=function(a,b,c,d){var e="banner"===a?I:"audio"===a?H:null;this._lookupQueueEntry(e,b,c,d)},this.maybeRetrieveAudioAds=function(){S&&C<=Aa()?(aa("Retrieving audio ads from server"),ma(na,function(a){Ba({serverError:!0})})):aa("Not retrieving audio ads from server")},this.maybeRetrieveBannerAds=function(){aa("Maybe retrieve banner ads?",Aa()-D,R),S&&R&&(Q||P||D<=Aa())&&(this._bannerInitialized=!0,aa("Retrieving banner ads from server"),ga(function(a,b){ja(a,b)},function(a){Ba({serverError:!0,banner:!0})}))},this.maybeRetrieveAds=function(){this.maybeRetrieveBannerAds(),this.maybeRetrieveAudioAds()},this.init=function(d,f,g){b=g,a=d,a.bind(j.PLAYER_CREATED,Va,e);for(var h=a.getPlayers(),i=0,k=h.length;k>i;i++)Wa(h[i]);a.bind(j.RECORD_AD_EVENT,Sa,e),a.onReady(function(){f.onReady(function(){f.getUserInfo(function(a){c=a,aa("SESSION",c),O=new Spotify.Cache.PackageStore({storageKey:Spotify.Utils.Base64.encode(a.user+"-"+a.catalogue)}),Ca(),e.maybeRetrieveAudioAds(),e.maybeRetrieveBannerAds(),e.serviceIsReady=!0,e.trigger(j.READY)},function(a){_("Exception thrown gathering user info",a)})},this)},this)},this.initializeContext=function(a){o=a,N=a.getInterceptList(),a.addEvents({playIntercepted:Xa,playEnd:function(a){ba("trackEnded","receivedEvent",a.track.uri),a.track.uri.indexOf("spotify:ad:")>-1&&(ba("trackEnded","call:_onAdEnded"),Ta())}})},this.setEnabled=function(a){S=a,aa("Set Enabled",a)},this.setBannerEnabled=function(a){R=!!a,!this._bannerInitialized&&this.serviceIsReady&&this.maybeRetrieveBannerAds()},this.__getAdChooserParser__=function(){return f},this.__getAdHistory__=function(){return K},this.__getAudioAdQueue__=function(){return H},this.__getBannerAdQueue__=function(){return I},this.__getMonitors__=function(){return k},this.__getPlayers__=function(){return l},this.__retrieveBannerAdsFromServer__=function(){ga(ja,function(a){console.error(a)})},this.__retrieveAudioAdsFromServer__=function(){ma(na,function(a){console.error(a)})},this.__setAudioAdBreakAvailableTime__=function(a){A=a},this.__getLastBannerAdQueue__=function(){return J},this.__getLastBannerAdQueueRules__=function(){for(var a={},b=0,c=J.length;c>b;b++)a[J[b]]=Ea(Ha(J[b]));return a},this.__adEvaluateRules__=Ea,this.__calculateServerTime__=ta,this.__clearAdEventHistory__=Pa,this.__clearInvalidAdsInQueue__=Fa,this.__getAdEventHistory__=Oa,this.__getAdQueues__=ca,this.__getAvoidAdsList__=ha,this.__incrementAudioAdbreakAvailableTime__=za,this.__lookupAdByFileId__=Ya,this.__lookupAdById__=Ha,this.__resetBannerQueue__=la,this.__retrieveAudioAdsForAdBreak__=Ia,this.__setAudioAdBreakTimeBetween__=function(a){a>0&&900>=a&&ya(a)}}},"src/playermonitor.js":function(a,b,c,d,e,f){!function(){"use strict";var a=new Spotify.Events,c=function(b,c,d){this.player=b,this.active=!1,this.interval=null,this.onStreamUpdate=c;var e=this;this.player.bind(a.PLAYING,function(){e.start(d||1e3)}),this.player.bind(a.PAUSED,function(){e.stop()})};c.prototype.start=function(a){this.active||(this.active=!0,this.interval=setInterval(this.onStreamUpdate,a||1e3))},c.prototype.stop=function(){this.active&&(this.active=!1,clearInterval(this.interval))},b.exports=c}()},"node_modules/spotify-promise/node_modules/spotify-deferred/src/deferred.js":function(a,b,c,d,e,f){!function(){"use strict";function a(){var a=g.splice(0);if(a.length)for(var b=0,c=a.length;c>b;b++)try{a[b]()}finally{}}var c="undefined"!=typeof window,d="function"==typeof Object.defineProperty;if(c&&window.__modDefFn)return void(b.exports=window.__modDefFn);var e,f,g=[];if(c&&window.postMessage){if(f=window.location.origin||window.location.protocol+"//"+window.location.hostname,e=window.postMessage.bind(window,"@execute_deferreds",f),!window.__hasDeferredHandler){d?Object.defineProperty(window,"__hasDeferredHandler",{value:1}):window.__hasDeferredHandler=1;var h=function(b){(b.origin==f||"@execute_deferreds"==b.data)&&a()};window.addEventListener?window.addEventListener("message",h):window.attachEvent("onmessage",h)}}else e="undefined"!=typeof setImmediate?setImmediate.bind(null,a):setTimeout.bind(null,a,10);var i=function(a){var b=!g.length;g.push(a),b&&e()};c&&!window.__modDefFn&&(d?Object.defineProperty(window,"__modDefFn",{value:i}):window.__modDefFn=i),b.exports=i}()},"node_modules/spotify-promise/src/promise.js":function(a,b,c,d,e,f){"use strict";function g(a,b){a.then(function(a){b.fulfill(a)},function(a){b.fail(a)})}function h(){this._state=k.UNFULFILLED,this._value=null,this._handlers=[],this._deferred=!1}var i=Array.prototype.slice,j=a("node_modules/spotify-promise/node_modules/spotify-deferred/src/deferred.js"),k={UNFULFILLED:0,FULFILLED:1,FAILED:2};h.defer="function"==typeof setImmediate?function(a){setImmediate(a)}:j,h.prototype.isUnfulfilled=function(){return this._state==k.UNFULFILLED},h.prototype.isFulfilled=function(){return this._state==k.FULFILLED},h.prototype.isFailed=function(){return this._state==k.FAILED},h.prototype.fulfill=function(a){var b=this;this._state===k.UNFULFILLED&&(this._value=a,this._state=k.FULFILLED,this._deferred||(h.defer(function(){b._runHandlers()}),this._deferred=!0))},h.prototype.fail=function(a){var b=this;this._state===k.UNFULFILLED&&(this._value=a,this._state=k.FAILED,this._deferred||(h.defer(function(){b._runHandlers()}),this._deferred=!0))},h.prototype.then=function(a,b){var c=this,d=new h;return this._handlers.push({fulfilled:a,failed:b,promise:d}),this._state===k.UNFULFILLED||this._deferred||(h.defer(function(){c._runHandlers()}),this._deferred=!0),d},h.prototype.pipe=function(a){this.then(function(b){a.fulfill(b)},function(b){a.fail(b)})},h.prototype._runHandlers=function(){this._deferred=!1;var a=this._value;if(this._state!=k.UNFULFILLED)for(var b=this._state===k.FULFILLED,c=this._handlers.splice(0),d=b?"fulfilled":"failed",e=0,f=c.length;f>e;e++){var h=c[e],i=h[d],j=h.promise;if(i&&"function"==typeof i){try{var l=i(a)}catch(m){j.fail(m);continue}l&&"function"==typeof l.then?g(l,j):j.fulfill(l)}else{if(a&&"function"==typeof a.then){g(a,j);continue}b?j.fulfill(a):j.fail(a)}}},h.prototype.catchError=function(a){return this.then(null,a)},h.prototype.get=function(a){var b=new h;return this.then(function(c){a in c?b.fulfill(c[a]):b.fail(new TypeError('No property "'+a+'" in object.'))},function(a){b.fail(a)}),b},h.prototype.access=function(a){a=Array.isArray(a)?a:i.call(arguments);for(var b=this,c=0,d=a.length;d>c;c++)b=b.get(a[c]);return b},h.prototype.call=function(a,b){var c=i.call(arguments,1),d=new h;return this.then(function(b){try{d.fulfill(b[a].apply(b,c))}catch(e){d.fail(e)}},function(a){d.fail(a)}),d},h.prototype.thenSpread=function(a,b){return this.then(function(b){return Array.isArray(b)?a.apply(this,b):a.call(this,b)},b)},h.join=function(a){a=Array.isArray(a)?a:i.call(arguments);for(var b=new h,c=a.length,d=[],e=!1,f=function(a,f){e||(d[a]=f,c--,c||b.fulfill(d))},g=function(a){e||(e=!0,b.fail(a))},j=0,k=c;k>j;j++){var l=a[j];l&&l.then?l.then(f.bind(null,j),g):f(j,l)}return b},h.group=function(a){a=Array.isArray(a)?a:i.call(arguments);for(var b=new h,c=0,d=a.length;d>c;c++)b.pipe(a[c]);return b},b.exports=h},"src/reactor.js":function(a,b,c,d,e,f){var g=a("node_modules/spotify-promise/src/promise.js"),h=a("src/events.js"),i={_construct:function(){this._core=null,this._events=new h,this._adsCore=null,this._adsCorePromise=this._createPromise(),this._eventQueue=[],this._eventPromiseQueue=[],this._subscribeAll({"resources.adchooser":this._onAdsCore})},_onAdsCore:function(a){this._adsCore=a,this._adsCoreListen(),this._setReady()},_adsCoreListen:function(){this._adsCoreAddEventListeners({ads_received:this._events.AD_RECEIVED,ads_available:this._events.AD_AVAILABLE,ads_not_available:this._events.AD_NOT_AVAILABLE,ads_break_change:this._events.AD_BREAK_CHANGED,ads_clear:this._events.AD_CLEAR,ads_break_started:this._events.AD_BREAK_STARTED,ads_break_ended:this._events.AD_BREAK_ENDED,ads_debug:this._events.AD_DEBUG})},_adsCoreAddEventListeners:function(a){var b;for(b in a)a.hasOwnProperty(b)&&this._adsCoreAddEventListener(b,a[b])},_adsCoreAddEventListener:function(a,b){var c=this;c._adsCore.addEventListener(b,function(b){var d,e={type:a,params:b.params};c._eventPromiseQueue.length>0?(d=c._eventPromiseQueue.shift(),d.fulfill(e)):c._eventQueue.push(e)})},_validateParam:function(a,b,c){for(var d=0,e=a.length;e>d;d++)if("undefined"==typeof b.body[a[d]])return c.fail("parameter missing: "+a[d]),!1;return!0},"GET /ads/breakinprogress":function(a,b){var c=this._createPromise();return c.fulfill(this._adsCore.adBreakInProgress()),c},"GET /ads/nextevent":function(a,b){var c=this._createPromise();return this._eventQueue.length>0?c.fulfill(this._eventQueue.shift()):this._eventPromiseQueue.push(c),c},"GET /ads/settings":function(a,b){var c=this._createPromise();return c.fulfill(this._adsCore.getSettings()),c},"UPDATE /ads/applistening":function(a,b){var c=this._createPromise();return a.body.appFrameId?(this._adsCore.appListening(a.body.appFrameId),c.fulfill(!0)):c.fail("missing parameter: appFrameId"),c},"UPDATE /ads/registerinventory":function(a,b){var c=this._createPromise(),d=a.body,e=["slotId","type","appData","contextInfo"];return this._validateParam(e,a,c)?(this._adsCore.registerInventory(d.slotId,d.type,d.appData,d.contextInfo),c.fulfill(!0),c):c},"UPDATE /ads/deregisterinventory":function(a,b){var c=this._createPromise(),d=a.body;return this._validateParam(["slotId","appFrameId"],a,c)?(this._adsCore.deregisterInventory(d.slotId,d.appFrameId)?c.fulfill(!0):c.fail("Slot not found: "+d.slotId+"|"+d.appFrameId),c):c},"UPDATE /ads/recordevent":function(a,b){var c=this._createPromise(),d=["slotId","type","appFrameId","adId","message"];if(!this._validateParam(d,a,c))return c;var e=a.body;return this._adsCore.recordAdEvent(e.slotId,e.type,e.appFrameId,e.adId,e.message)?c.fulfill(!0):c.fail("Event could not be recorded on "+e.adId+": "+e.type),c},"UPDATE /ads/pause":function(a,b){var c=this._createPromise();return this._adsCore.pause(),c.fulfill(!0),c},"UPDATE /ads/resume":function(a,b){var c=this._createPromise();return this._adsCore.resume(),c.fulfill(!0),c},"UPDATE /ads/previewinventory":function(a,b){var c=this._createPromise(),d=["adId","slotId","appFrameId"],e=a.body;return this._validateParam(d,a,c)?c:(this._adsCore.previewInventory(e.adId,e.slotId,e.appFrameId).pipe(c),c)},"UPDATE /ads/useractive":function(a,b){var c=this._createPromise();return this._adsCore.setUserActive(),c.fulfill(!0),c},"UPDATE /ads/userinactive":function(a,b){var c=this._createPromise();return this._adsCore.setUserInactive(),c.fulfill(!0),c}},j=new g;j.proto=i,b.exports=j},"src/utils.js":function(a,b,c,d,e,f){var g=a("node_modules/spotify-promise/src/promise.js"),h={escapeHtml:function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},unescapeHtml:function(a){return(""+a).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&amp;/g,"&")},copy:function(a){var b,c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c},merge:function(){for(var a={},b=0,c=arguments.length;c>b;b++)if("object"==typeof arguments[b])for(var d in arguments[b])arguments[b].hasOwnProperty(d)&&(a[d]=arguments[b][d]);

return a},logger:function(a,b){return function(){Spotify.DebuggerJS[b?b:"log"](a,[].slice.call(arguments),"adscorejs")}},includeScript:function(a){a.match(/^\/\//)&&"object"==typeof location&&"string"==typeof location.protocol&&(a=location.protocol+a);var b=new g,c=document.createElement("script");return c.type="text/javascript",c.onload=function(){b.fulfill(!0)},c.onerror=function(){b.fail("script failed to load: "+a)},c.src=a,document.getElementsByTagName("head")[0].appendChild(c),b},sendCORSRequest:function(a,b,c,d){var e=null;d=d||{};var f=new g;try{if(e=new XMLHttpRequest,"withCredentials"in e)e.open(a,b,!0),d.noCredentials||(e.withCredentials=!0);else{if("undefined"==typeof XDomainRequest)return f.fail("CORS not supported in this environment."),f;e=new XDomainRequest,e.open(a,b)}e.onload=function(){f.fulfill(e.responseText)},e.onerror=function(a){f.fail("CORS Request failed - see console for details.")};{c?e.send(c):e.send()}}catch(h){f.fail(h)}return f},throttle:function(a,b){var c;return function(){return!c||Date.now()>c+a?(c=Date.now(),b.apply(null,arguments)):void 0}},once:function(a){var b=!1;return function(){b||(b=!0,a.apply(null,arguments))}},arrayContains:function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return!0;return!1}};b.exports=h},"src/responder.js":function(a,b,c,d,e,f){!function(){var c=a("node_modules/spotify-promise/src/promise.js"),d=a("src/inventorytype.js").InventoryTypeById,e=a("src/utils.js"),f=a("src/events.js"),g=e.logger("Spotify.Ads.Responder"),h={_ready:!1,_events:new f,_appEventCleanInterval:1e4,_listeners:null,_isListening:null,_appEventData:null,_appEventCleanedAt:null,init:function(a){this._isListening=!1,this._appEventData=[],this._receiveEventBound=this._receiveEvent.bind(this),this._setReady()},getNumberOfApplications:function(){return this._appEventData.length},cleanEventData:function(a){this._lastCleanedAppEventData=0,this._cleanEventData(a)},_dispatch:function(a,b){{var c,d,e,f;this._listeners}for(b=b||{},g("dispatch",a,b),d=0,e=this._appEventData.length;e>d;d++)c=this._appEventData[d],(!b.appFrameId||c.app.isActive()&&c.app.getFrame().id===b.appFrameId)&&(f={type:a,data:b},f.data.appFrameId&&delete f.data.appFrameId,c.promise?(c.promise.fulfill(f),c.promise=null,c.timestamp=Date.now()):c.events.push(f));this._cleanEventData()},_appListening:function(a){var b=this._getAppEventData(a);return b===!1&&(b={app:a,events:[],promise:null},this._appEventData.push(b)),b.timestamp=Date.now(),b},_cleanEventData:function(a){if(a=a||Date.now(),!this._lastCleanedAppEventData||this._lastCleanedAppEventData<a-this._appEventCleanInterval){this._lastCleanedAppEventData=a;for(var b=[],c=0,d=this._appEventData.length;d>c;c++)this._appEventData[c].destroyed||b.push(this._appEventData[c]);this._appEventData=b}},_getAppEventData:function(a){var b,c,d=!1;for(b=0,c=this._appEventData.length;c>b;b++)if(this._appEventData[b].app===a){d=b;break}return d===!1?!1:this._appEventData[d]},_adsCoreListen:function(a){this._lastAppListening=a,a.update("/ads/applistening",null,{appFrameId:a.getFrame().id}).then(function(){},function(a){}),this._listening||(this._listening=!0,a.get("/ads/nextevent").then(this._receiveEventBound))},_receiveEvent:function(a){this._dispatch(a.type,a.params),this._lastAppListening.get("/ads/nextevent").then(this._receiveEventBound)},_recordAdEvent:function(a,b,c){var d=c[0],e=c[1],f=c[2];return a.update("/ads/recordevent",null,{slotId:d,type:b,appFrameId:a.getFrame().id,adId:void 0===e?null:e,message:void 0===f?null:f})},"*ads_event_wait":function(a,b,c){var d,e,f=this._createPromise();return d=this._appListening(a),d.events.length?(e=d.events.shift(),f.fulfill(e)):(c=c.persist(),d.promise=f),this._adsCoreListen(a),f},"*ads_register_inventory":function(a,b){var c,e=this,f=this._createPromise(),g=b.args[0],h=b.args[1],i=b.args[2];if(!d[h])return f.fail("inventoryType not valid: "+h),f;if(!a.isActive()&&"hpto"!==h)return f.fail("app is not active"),f;c=d[h];for(var j=new Spotify.EventTarget,k=["activate","deactivate","destroy"],l=function(b,c){a.addEvent(b,function(d){if(c.trigger(b,d),"destroy"===b){var f=e._getAppEventData(a);f&&(f.destroyed=!0)}})},m=0,n=k.length;n>m;m++)l(k[m],j);var o={bundleId:a.getAppLink().id,frameId:a.getFrame().id,publisher:j};return a.update("/ads/registerinventory",null,{slotId:g,type:c,appData:o,contextInfo:i}).pipe(f),f},"*ads_deregister_inventory":function(a,b){var c=this._createPromise(),d=b.args[0];return a.update("/ads/deregisterinventory",null,{slotId:d,appFrameId:a.getFrame().id}).then(function(){c.fulfill(!0)},function(){c.fail(new Spotify.Bridge.Error.NotFound("The slotId was not found in registered inventory: "+d))}),c},"*ads_preview":function(a,b){var c=this._createPromise(),d=b.args[0],e=b.args[1];return a.update("/ads/previewinventory",null,{adId:d,slotId:e,appFrameId:a.getFrame().id}).pipe(c),c},"*ads_break_in_progress":function(a,b){var c=this._createPromise();return a.get("/ads/breakinprogress").pipe(c),c},"*ads_click":function(a,b){var c=this._createPromise();return this._recordAdEvent(a,"click",b.args).pipe(c),c},"*ads_render":function(a,b){var c=this._createPromise();return this._recordAdEvent(a,"render",b.args).pipe(c),c},"*ads_error":function(a,b){var c=this._createPromise();return this._recordAdEvent(a,"error",b.args).pipe(c),c},"*ads_user_active":function(a,b){var c=this._createPromise();return a.update("/ads/useractive",null,{}).pipe(c),c},"*ads_user_inactive":function(a,b){var c=this._createPromise();return a.update("/ads/userinactive",null,{}).pipe(c),c},"*ads_pause":function(a,b){var c=this._createPromise();return g("*ads_pause"),a.update("/ads/pause",null,{}).pipe(c),c},"*ads_resume":function(a,b){var c=this._createPromise();return a.update("/ads/resume",null,{}).pipe(c),c},"*ads_init":function(a,b){var c=this._createPromise();return this._appListening(a),a.get("/ads/settings",null,{}).pipe(c),c}},i=new c;i.proto=h,b.exports=i}()},"src/audioadmanager.js":function(a,b,c,d,e,f){!function(){"use strict";var c=a("src/playermonitor.js"),d=a("src/utils.js"),e=a("node_modules/spotify-promise/src/promise.js"),f=a("src/events.js"),g=a("src/inventorytype.js").InventoryType,h=new Spotify.Events,i=new f,j=["title","description","advertiser","caption","click","clickPrefix"],k="//s0.2mdn.net/instream/html5/ima3.js",l=d.logger("Spotify.Ads.AudioAdManager","log"),m=d.logger("Spotify.Ads.AudioAdManager","error"),n=1e3,o=function(){Spotify.EventTarget.call(this);var a,b,f,o,p,q,r,s,t,u,v,w,x,y=this,z=0,A=899,B=[],C=[],D=!1,E=!1,F=!1,G=!1,H={NEXT:"NEXT",PREV:"PREV"},I=function(a,b,c){try{var d={source:"Ads.Core",context:"Spotify.Ads.AudioAdManager",event:a,event_version:b,source_version:"0.0.1",source_vendor:"ads",data:"undefined"!=typeof c?JSON.stringify(c):""};u.logClientEvent(d,function(){l("Logged Client Event",d)})}catch(e){m("Could not logClientEvent",e)}},J=function(b){l("create player monitor",b);var d=new c(b,function(){b.isPlaying===!0&&b.isAd===!1&&(z++,z%5===0&&(a.setItem("streamTime",z),l("Stream time:",z,A),z>=A&&O()))},n);return d},K=function(a){var c=b.getPlayerById(a.params.id);L(c)},L=function(a){C.push(a);var b=J(a);B.push(b)},M=function(){p=document.createElement("div"),p.style.display="none",document.body.appendChild(p),l("include script"),d.includeScript(k).then(function(){l("ima3 ready"),D=!0})},N=function(a){var b,c="ERROR_UNKNOWN";return a&&"function"==typeof a.getError&&(b=a.getError(),b&&"function"==typeof b.getErrorCode&&(c=b.getErrorCode()||"ERROR_NO_MESSAGE")),c},O=d.throttle(15e3,function(){D&&!E&&t.getTargetingParameters().then(function(a){P(f,a)})}),P=d.throttle(5e3,function(a,b){if(D&&!E){l("requestAd"),s||(q||(p.innerHTML="",q=new google.ima.AdDisplayContainer(p),q.initialize()),s=new google.ima.AdsLoader(q),s.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,Q,!1),s.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,U,!1));var c=s.getSettings();a&&c.setPpid(a);var d="/6465052/web",e=new google.ima.AdsRequest,f="",h=[];for(var i in b)b.hasOwnProperty(i)&&h.push(i+"="+b[i]);f=h.join("&");var j=g.AUDIO.sizes[0].join("x"),k=g.AUDIO.companionSizes.map(function(a){return a.join("x")}).join(",");e.adTagUrl=window.location.protocol+"//pubads.g.doubleclick.net/gampad/ads?sz="+j+"&ciu_szs="+k+"&iu="+d+"&impl=s&gdfp_req=1&env=vp&output=xml_vast2&unviewed_position_start=1&url=&cust_params="+encodeURIComponent(f)+"&ad_rule=0&correlator="+Date.now();var m=function(){l("ad request",e.adTagUrl),e.linearAdSlotWidth=1,e.linearAdSlotHeight=1,e.nonLinearAdSlotWidth=1,e.nonLinearAdSlotHeight=1,s.requestAds(e)};m()}}),Q=function(a){l("adsManagerLoaded"),r=a.getAdsManager({currentTime:0}),r.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,T),r.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,aa),r.addEventListener(google.ima.AdEvent.Type.LOADED,V),r.addEventListener(google.ima.AdEvent.Type.STARTED,$),r.addEventListener(google.ima.AdEvent.Type.PAUSED,R),r.addEventListener(google.ima.AdEvent.Type.RESUMED,S),E=!0},R=function(){G=!1,ba(),x&&(x.playing=!1,_())},S=function(){l("onAdResumed"),G=!0,da(),x&&(x.playing=!0,_())},T=function(a){F&&(aa(),r&&r.stop());var b=N(a);I("AdError",b),m("AdError",b)},U=function(a){var b=N(a);I("AdLoadError",b),m("AdLoadError",b)},V=function(){},W=function(a){var b={},c=a.getElementsByTagName("a")[0];if(c){b.clickUrl=c.href;var d=c.getElementsByTagName("img")[0];d&&(b.imageUrl=d.src)}return b},X=function(a){var b={};try{var c=a.innerHTML.replace(/<!-- spotify media-details\/(start|end) -->/gi,"");b=JSON.parse(c)["media-details"]||{},l("media-details-json",b);for(var d,e=0,f=j.length;f>e;e++)d=j[e],"string"==typeof b[d]&&(b[d]=decodeURIComponent(b[d]));b.click&&b.clickPrefix&&(b.clickDestination=b.click,b.click=b.clickPrefix+encodeURIComponent(b.click)),b.advertiser&&(b.description=b.advertiser)}catch(g){m("Error parsing media details JSON",a?a.innerHTML:null,g)}return b},Y=function(a){for(var b={},c=a.getElementsByTagName("span")||[],d=!1,e=0,f=c.length;f>e;e++)if("media-details"===c[e].getAttribute("data-template")){d=!0,l("media-details",c[e].innerHTML),b=X(c[e]);break}return d||m("Could not extract media-details JSON",a.innerHTML),b},Z=function(a,b){var c=document.createElement("div"),d={};switch(c.innerHTML=a,p.appendChild(c),b){case"image":d=W(c);break;case"media-details":d=Y(c)}return setTimeout(function(){c.parentNode.removeChild(c)},2e3),d},$=function(a){if(!F)return void(r&&r.pause());l("ad started",a);var b=a.getAd();if(b.isLinear()){var c=b.getCompanionAds(300,300),d=null,e={};c&&c.length>0&&(d=Z(c[0].getContent(),"image"));var f=b.getCompanionAds(301,301);f&&f.length>0&&(e=Z(f[0].getContent(),"media-details"),e.image&&!d&&(d={imageUrl:e.image,clickUrl:e.click})),d=d||{},x={duration:parseInt(1e3*b.getDuration(),10),imageUrl:d.imageUrl,clickUrl:d.clickUrl,title:e.title,description:e.description,position:0,playing:!0},G=!0,_(),da()}},_=function(){x&&F&&(y.trigger(i.AD_BREAK_CHANGED,x),l("AD_BREAK_CHANGED",d.copy(x)))},aa=function(b){switch(E=!1,F=!1,fa(),ba(),z=0,v){case H.NEXT:o.next("trackdone");break;case H.PREV:o.previous("trackdone")}a.setItem("streamTime",z),y.trigger(i.AD_BREAK_ENDED),s.contentComplete()},ba=function(){w&&(clearInterval(w),w=null)},ca=function(){x&&r&&(x.position=parseInt(x.duration-1e3*r.getRemainingTime(),10))},da=function(){l("start-playback-monitor",1e3),ba(),ca(),w=setInterval(function(){l("monitor-hook"),x&&r?(ca(),_()):F||ba()},1e3)},ea=function(){o.pause(),o.setOverrideRules({skipCount:-1,volume:!0,seek:!1,indexing:!1,previous:!1,playpause:!1,next:!1,shuffle:!1,repeat:!1})},fa=function(){o.removeOverrideRules()},ga=function(){!F&&E&&r&&(l("startAdBreak"),F=!0,ea(),o.getBaseState().then(function(a){r.setVolume(a.volume>0?a.volume:.5),r.init(1,1,google.ima.ViewMode.NORMAL),r.start(),r.resume(),y.trigger(i.AD_BREAK_STARTED)}))},ha=function(){t.getStreamTimeBetweenAdBreaks().then(function(a){A=a}),t.getPpid().then(function(a){f=a})};this._setStreamTimeBetweenAdBreaks=function(a){a>0&&900>=a&&(A=a)},this._setPlayerMonitorInterval=function(a){a>0&&(n=a)},this.initialize=function(c,d,f,g){var i=new e;b=c,l("bind",h.PLAYER_CREATED,b),b.bind(h.PLAYER_CREATED,K,y);for(var j=b.getPlayers(),k=0,m=j.length;m>k;k++)L(j[k]);return u=g,b.onReady(function(){d.onReady(function(){d.getUserInfo(function(b){l("user info",b),a=new Spotify.Cache.PackageStore({storageKey:"ads-audio-"+Spotify.Utils.Base64.encode(b.user+"-"+b.catalogue)}),a.getItem("streamTime")>0&&(z=a.getItem("streamTime")),M(),i.fulfill(!0)})})}),t=f,ha(),i},this.initializeContext=function(a){o=a,o.addEvents({beforeNext:function(a){E&&!F&&(a.preventDefault(),v=H.NEXT,ga())},beforePrevious:function(a){E&&!F&&(a.preventDefault(),v=H.PREV,ga())},volumeChange:function(a){a.volume>0&&a.volume<=1&&F&&r&&r.setVolume(a.volume)}})},this.pause=function(){return r&&G?(r.pause(),!0):!1},this.resume=function(){return r&&!G?(r.resume(),x&&(x.playing=!0,G=!0,da(),_()),!0):!1}};b.exports=o}()},"src/laser.js":function(a,b,c,d,e,f){!function(){"use strict";var c=a("node_modules/spotify-promise/src/promise.js"),d=a("src/utils.js"),e=a("src/events.js"),f=new e,g=function(a){Spotify.EventTarget.call(this),this._metadataService=a;var b=this,e=600,h=120,i="/6465052/web",j="/6465052/premium-web",k="hm://lasertag/v1/adtag/",l=3e3,m={};this.initializeContext=function(a){o=a,this.trigger("initializeContext")},this.getTargetingParameters=function(){var a=new c,b=this._getClientParameters(),e=this._getLasertagParameters();return c.join(b,e).then(function(b){a.fulfill(d.merge(b[0]||{},b[1]||{}))},function(c){q("lasertag failed",c),b.then(function(b){a.fulfill(d.merge(b,m))},function(){e.then(function(b){a.fulfill(b)},function(){a.fulfill({})})})}),a},this.getInventoryUnit=function(a){var b=new c;return b.fulfill(a?j:i),b},this.getStreamTimeBetweenAdBreaks=function(){var a=new c;return this._getLasertagData().then(function(b){b.streamTimeBetweenAdBreaks>0?a.fulfill(b.streamTimeBetweenAdBreaks):a.fail(g.ErrorType.NOT_FOUND)},function(){a.fail(g.ErrorType.NOT_FOUND)}),a},this.setOverrideData=function(a,b){"object"==typeof a?m=a:"string"==typeof a&&(m[a]=""+b)},this.getPpid=function(){var a=new c;return this._getLasertagData().then(function(b){b.ppid?a.fulfill(b.ppid):a.fail(g.ErrorType.NOT_FOUND)},function(){a.fail(g.ErrorType.NOT_FOUND)}),a},this._getLasertagParameters=function(){var a=new c;return this._getLasertagData().then(function(b){a.fulfill(b.targeting)},function(b){a.fail(b)}),a},this._getLasertagData=function(){var a=new c;return n.data&&Date.now()<1e3*n.ttl+n.updated?a.fulfill(this._decorate(n.data)):this._timeOfLastFailure&&this._timeOfLastFailure>Date.now()-1e3*h?a.fail(g.ErrorType.SERVER):(this._currentRequestPromise||this._sendLasertagRequest()).then(function(c){a.fulfill(b._decorate(c))},function(){a.fail(g.ErrorType.NOT_FOUND)}),a},this._onInitContext=function(a,b,c){if(o)a();else{var d=!1,e=!1;this.bind("initializeContext",function(){d||(e=!0,a())}),b&&(c=c||3e3,setTimeout(function(){e||(d=!0,b())},c))}},this._getClientParameters=function(a){var d=new c;return this._onInitContext(function(){o.getBaseState().then(function(a){var c={};try{var e,f=a.track;f?(f.albumUri&&(c.album=f.albumUri),f.artists&&f.artists.length>0&&(e=c.artist=f.artists[0].uri),e&&b._metadataService?b._metadataService.lookup(e,function(a){p("artistData",e,a),a&&a.genre&&a.genre.length>0&&(c.genre=a.genre[0]),d.fulfill(c)},function(a){d.fulfill(c)}):d.fulfill(c)):d.fulfill(c)}catch(g){q("error parsing track info",g),d.fail(g)}},function(){q("cannot get contextPlayer baseState"),d.fail("cannot get contextPlayer baseState")})},function(){d.fail(g.ErrorType.TIMEOUT)}),d},this._sendLasertagRequest=function(a){p("sending request to "+k);var d=new c;this._currentRequestPromise=d;var h=!1,i=!1,j=new Spotify.Calls.Hermes({header:{uri:k,method:"GET"},payload:[],payloadSchemas:[],responseSchemas:["lasertag#AdTagResponse"],type:"lasertag"},function(a){p("lasertag SUCCESS",a),i=!0,a=a[0];var c={ppid:null,targeting:{},streamTimeBetweenAdBreaks:0};if(a.ppid&&(c.ppid=a.ppid),a.streamTimeBetweenAdBreaks>0&&(c.streamTimeBetweenAdBreaks=a.streamTimeBetweenAdBreaks),a.keyValues)for(var f=0,g=a.keyValues.length;g>f;f++)c.targeting[a.keyValues[f].key]=a.keyValues[f].value;n.ttl=a.ttl||e,n.data=c,n.updated=Date.now(),b._currentRequestPromise=null,h||d.fulfill(c)},function(a){a=a||"lasertag did not respond successfully",q(a),b._currentRequestPromise=null,b._timeOfLastFailure=Date.now(),h||d.fail(g.ErrorType.SERVER)});return this.trigger(f.HERMES_REQUEST,j),setTimeout(function(){i||(h=!0,q("lasertag-request TIMEOUT"),d.fail(g.ErrorType.TIMEOUT))},l),d};var n={data:null,ttl:null,updated:null};this._decorate=function(a){a.targeting||(a.targeting={});for(var b in m)"string"==typeof b&&"string"==typeof m[b]&&(a.targeting[b]=m[b]);return a};var o,p=d.logger("Spotify.Ads.Laser","log"),q=d.logger("Spotify.Ads.Laser","error")};g.ErrorType={NOT_FOUND:"NOT_FOUND",TIMEOUT:"TIMEOUT",SERVER:"SERVER"},b.exports=g}()},"src/gpt.js":function(a,b,c,d,e,f){var g=a("src/utils.js"),h=function(a,b,c,d){var e=function(){return"var googletag = googletag || {}; googletag.cmd = googletag.cmd || [];(function() {var useSSL = true;var src = (useSSL ? 'https:' : 'http:') + '//www.googletagservices.com/tag/js/gpt.js';document.write('<scr' + 'ipt src=\"' + src + '\"></scr' + 'ipt>');})();"},f=function(){var e="[["+b.width+","+b.height+"]]",f="";for(var h in d)d.hasOwnProperty(h)&&(f+='.setTargeting("'+g.escapeHtml(h)+'","'+g.escapeHtml(d[h])+'")');return"googletag.cmd.push(function() { \n  googletag.defineSlot('"+c+"', "+e+", '"+a+"').addService(googletag.pubads())"+f+";\n  googletag.pubads().enableSingleRequest();\n  googletag.pubads().enableSyncRendering();\n  googletag.enableServices();\n});\n"},h=function(){return'<div id="'+a+'" style="width: '+b.width+"px; height: "+b.height+'px">\n<script type="text/javascript">\n googletag.cmd.push(function() {    googletag.display("'+a+'");  });\n</script>\n</div>\n'};this.getTagHtml=function(){return'<html>\n<head>\n<script type="text/javascript">\n'+e()+"\n"+f()+'</script>\n</head>\n<body style="margin:0px">\n'+h()+"</body>\n</html>"}};b.exports=h},"src/core.js":function(a,b,c,d,e,f){var g=a("src/gpt.js"),h=a("src/sourcetype.js"),i=a("src/inventorytype.js").InventoryType,j=a("src/events.js"),k=a("src/utils.js"),l=a("node_modules/spotify-promise/src/promise.js"),m=function(){"use strict";Spotify.EventTarget.call(this),this._inventory={};var a,b=Spotify.DebuggerJS,c=this,d=new Spotify.Events,e=new j,f=!0,m=!1,n={},o=180,p=3e4,q=18e4,r=h.DFP,s=function(a){return b.error("Spotify.Ads.Core",Array.prototype.slice.call(arguments,0),"corejs"),a},t=k.logger("Spotify.Ads.Core","log");this.setSource=function(a){var b=!1;for(var c in h)h[c]===a&&(b=!0);if(!b)throw new Error("Source not defined on SourceType: "+a);r=a},this._onAdBreakStarted=function(a){this._adBreakInProgress=!0,t("AD_BREAK_STARTED"),this.trigger(e.AD_BREAK_STARTED,a||{}),this._pauseAllSlotTimeouts()},this._onAdBreakEnded=function(a){this._adBreakInProgress=!1,t("AD_BREAK_ENDED"),this.trigger(e.AD_BREAK_ENDED,a||{}),this._resumeAllSlotTimeouts()},this._onAdBreakChange=function(a){t("AD_BREAK_CHANGED",a),this.trigger(e.AD_BREAK_CHANGED,a||{})},this._getAdTag=function(){var a=new l;return l.join(this._laser.getInventoryUnit(!f),this._laser.getTargetingParameters()).then(function(b){a.fulfill({inventoryUnit:b[0],targetingParameters:b[1]})},function(b){a.fail(b)}),a},this._normalizeSlotId=function(a,b){return b?b+"_"+a:"chrome_"+a},this._refreshInventory=function(a){this._inventory[a]&&this._populateInventory(a)},this._renderInventory=function(a,b){var d=this._inventory[a];return d?void(b&&(b.payload||b.imageUrl)?(c.trigger(e.AD_AVAILABLE,{slotId:d.slotId,type:d.type.id,appFrameId:d.appFrameId,contextInfo:d.contextInfo,size:d.size}),c.trigger(e.AD_RECEIVED,{payload:b.payload,adId:b.adId,appFrameId:d.appFrameId,type:d.type.id,iframe:!!b.iframe,targetUrl:b.targetUrl,imageUrl:b.imageUrl,slotId:d.slotId,contextInfo:d.contextInfo,size:d.size})):(c.trigger(e.AD_NOT_AVAILABLE,{slotId:d.slotId,type:d.type.id,appFrameId:d.appFrameId,contextInfo:d.contextInfo}),c._beginSlotTimeout(a,q))):void s("inventory not registered: "+a)},this._buildAd=function(a){var b;switch(r){case h.INTERNAL:b={adId:a.ad_id},a.html?(b.payload=a.html,b.iframe=!0):a.image_id?(b.imageUrl=Spotify.SourceURLs.original+a.image_id,b.targetUrl=a.target_url||"",b.payload='<a target="_blank" href="'+b.targetUrl+'"><img src="'+b.imageUrl+'" /></a>'):(b=!1,s("Ad entry does not have image_id or html component: "+a.ad_id))}return b},this._populateInventory=function(a,b){var d=!1,e=this._inventory[a];if(!e)return void s("inventory not defined: "+a);switch(this._resetSlotTimeout(a),r){case h.INTERNAL:e.adId=null,e.sentBannerShown=!1;var f=null;b?f=b:e.type===i.LEADERBOARD&&(f=this.adChooser.getBannerAd()),f&&(e.adId=f.ad_id,e.duration=f.duration>0?1e3*f.duration:0,e.sentBannerShown=!1,d=this._buildAd(f)),c._renderInventory(a,d);break;case h.DFP:var g=c._renderGptTag.bind(c,a);c._getAdTag(a).then(g)}},this._renderGptTag=function(a,b){var d=this._inventory[a],e=new g(d.slotId,d.size,b.inventoryUnit,b.targetingParameters),f={iframe:!0,payload:e.getTagHtml()};c._renderInventory(a,f)},this._getInventoryByAdId=function(a){var b,c=[];for(b in this._inventory)this._inventory.hasOwnProperty(b)&&this._inventory[b].adId===a&&c.push(this._inventory[b]);return c.length?(c.sort(function(a,b){return a.timeRegistered<b.timeRegistered?1:-1}),c[0]):null},this._beginSlotTimeout=function(a,b){var d=this._inventory[a];return d&&d.type.refresh?(b=b||d.duration||p,t("beginSlotTimeout",a,b),d.timeoutId&&this._resetSlotTimeout(a),d.timeoutDuration||(d.timeoutDuration=b),d.timeoutBegin=Date.now(),d.paused=0,d.timeoutId=setTimeout(function(){c._refreshInventory(a)},b),b):!1},this._pauseSlotTimeout=function(a){var b=this._inventory[a];b&&b.timeoutId?(t("pauseSlotTimeout",a),clearTimeout(b.timeoutId),b.timeoutId=null,b.timeoutProgress+=Date.now()-b.timeoutBegin,b.paused=1):b||s("pause: slot not found",a)},this._resumeSlotTimeout=function(a){var b,c=this._inventory[a];return c.timeoutDuration>0&&c.timeoutProgress<c.timeoutDuration?(b=c.timeoutDuration-c.timeoutProgress,this._beginSlotTimeout(a,b)):(s("cannot resume slot",a,c),!1)},this._resetSlotTimeout=function(a){var b=this._inventory[a];b&&(t("resetSlotTimeout",a),b.timeoutId&&(clearTimeout(b.timeoutId),b.timeoutId=null),b.timeoutProgress=0,b.timeoutDuration=0,b.timeoutBegin=0,b.paused=0)},this._deregisterSlot=function(a){var b=this._inventory[a];return b&&(delete this._inventory[a],b.timeoutId&&clearTimeout(b.timeoutId)),b?!0:!1},this._pauseAllSlotTimeouts=function(){for(var a in this._inventory)this._inventory.hasOwnProperty(a)&&this._inventory[a].timeoutId&&this._pauseSlotTimeout(a)},this._resumeAllSlotTimeouts=function(){for(var a in this._inventory)this._inventory.hasOwnProperty(a)&&this._inventory[a].paused&&this._resumeSlotTimeout(a)},this._setStreamTimeBetweenAdBreaks=function(a){this.adChooser&&this.adChooser.__setAudioAdBreakTimeBetween__(a),this._audioAdManager&&this._audioAdManager._setStreamTimeBetweenAdBreaks(a)},this._initWithUserInfo=function(a){f="1"===a.ads,t("User has Ads?",f,a.ads),this.adChooser.bind(e.AD_BREAK_STARTED,this._onAdBreakStarted.bind(this)),this.adChooser.bind(e.AD_BREAK_ENDED,this._onAdBreakEnded.bind(this)),r===h.DFP?(t("initialize DFP"),this._laser.bind(e.HERMES_REQUEST,function(a){a.params instanceof Spotify.Calls.Hermes&&c.send(a.params)}),f?(t("initialize audio"),this._audioAdManager.initialize(this._audioManager,this._userService,this._laser,this._logger).then(function(){c.isReady=!0,c.trigger(d.READY)}),this._audioAdManager.bind(e.AD_BREAK_STARTED,c._onAdBreakStarted.bind(this)),this._audioAdManager.bind(e.AD_BREAK_ENDED,this._onAdBreakEnded.bind(this)),this._audioAdManager.bind(e.AD_BREAK_CHANGED,this._onAdBreakChange.bind(this))):(t("user is not a free account, do not initialize audio"),this.isReady=!0,this.trigger(d.READY)),this.adChooser.setEnabled(!1)):(this.adChooser.init(this._audioManager,this._userService,this._logger),this.isReady=!0,this.trigger(d.READY))},this.initialize=function(a,b,d,e,f,g){t("initialize ads core"),this._core=a,this._audioManager=b,this._userService=d,this._logger=e,this._audioAdManager=f,this._laser=g,this.adChooser=this._core.services.adChooser,d.onReady(function(){d.getUserInfo(function(a){c._initWithUserInfo(a)})})},this.initializeContext=function(b){a=b,r===h.DFP&&(this._audioAdManager&&this._audioAdManager.initializeContext(b),this._laser&&this._laser.initializeContext(a))},this.onReady=function(a,b){this.isReady?a.call(b):this.bind(d.READY,a,b)},this.recordAdEvent=function(a,b,c,d,e){var f=!1,g=this._normalizeSlotId(a,c),i=this._inventory[g];if(!i)return s("slotId not found: "+g),f;if(this.adChooser&&r===h.INTERNAL){if(!d&&(d=i.adId,!d))return s("adId must be defined to record ad event"),f;f=this.adChooser.recordAdEventById(d,b),"render"===b?this.adChooser.recordImpression(d):"click"===b?this.adChooser.recordImpression(d,!0):"error"===b&&this.adChooser.recordImpression(d,!1,e)}return"render"===b?(i.timeRendered=(new Date).getTime(),i.preview||this._beginSlotTimeout(g)):"error"===b&&(this._resetSlotTimeout(g),i.preview||this._refreshInventory(g)),f},this.previewInventory=function(a,b,d){var e,f=new Spotify.Promise;return b&&(e=c._normalizeSlotId(b,d),!c._inventory[e])?(f.fail("Registered slot not found: "+b),f):(c.onReady(function(){c.adChooser.lookupAdEntry("banner",a,function(b){var d,g=c._buildAd(b);if(g){if(b.banner_type)for(d in i)i.hasOwnProperty(d)&&i[d].adChooserBannerType===b.banner_type&&(g.type=i[d].id);f.fulfill(g),e?(c._inventory[e].preview=!0,c._populateInventory(e,b)):c._pauseAllSlotTimeouts()}else f.fail("ad unit could not be built from metadata: "+a)},function(a){f.fail(a)})}),f)},this.setUserActive=function(){var a,b,c,d=0;if(this._userInactivePaused&&!this._adBreakInProgress)for(a=0,b=this._userInactivePaused.length;b>a;a++)c=this._userInactivePaused[a],this._inventory.hasOwnProperty(c)&&(this._resumeSlotTimeout(c),d++);return this._userInactivePaused=null,d},this.setUserInactive=function(){var a;this._userInactivePaused=[];for(a in this._inventory)this._inventory.hasOwnProperty(a)&&!this._inventory[a].paused&&(this._pauseSlotTimeout(a),this._userInactivePaused.push(a));return this._userInactivePaused.length},this.registerInventory=function(a,b,d,e){var g=new l;return this.onReady(function(){var h=d?d.frameId:null,j=c._normalizeSlotId(a,h),k=null,l=null;if("object"!=typeof b||!b.id)return void g.fail("inventoryType not valid: "+JSON.stringify(b));if(!f&&b!==i.HPTO){var m="user is not a free account, non-hpto inventory not available";return t(m),void g.fail(m)}b.sizes&&(k={width:b.sizes[0][0],height:b.sizes[0][1]}),d&&(l=d.bundleId?d.bundleId:null,d.publisher&&(d.publisher.bind("deactivate",function(){t("app deactivate: "+d.frameId),c._pauseSlotTimeout(j)}),d.publisher.bind("activate",function(){t("app activate: "+d.frameId),c._inventory[j].timeoutBegin?c._resumeSlotTimeout(j):c._populateInventory(j)}),d.publisher.bind("destroy",function(){t("app destroy: "+d.frameId),c.deregisterAppInventory(h),delete n[h]}))),c._inventory[j]={slotId:a,type:b,size:k,bundleId:l,bundleArguments:d.bundleArguments,appFrameId:h,contextInfo:e,timeRegistered:Date.now(),timeRendered:null,duration:null},c._populateInventory(j),g.fulfill(!0)}),g},this.deregisterInventory=function(a,b){return this._deregisterSlot(this._normalizeSlotId(a,b))},this.deregisterAppInventory=function(a){var b=this._inventory;for(var c in b)b.hasOwnProperty(c)&&b[c].appFrameId===a&&this._deregisterSlot(c)},this.inventoryIsPaused=function(a,b){var c=this._normalizeSlotId(a,b);return this._inventory[c]?!!this._inventory[c].paused:void 0},this.getInventoryCount=function(){var a=0;for(var b in this._inventory)this._inventory.hasOwnProperty(b)&&a++;return a},this.appListening=function(a){n[a]||(n[a]=!0,m&&setTimeout(function(){c.trigger(e.AD_DEBUG)},0))},this.setDebug=function(a){m=void 0===a?!0:!!a,m?(DebuggerJS.on(["Spotify.Ads.Core","Spotify.Services.AdChooser","Spotify.Parsers.AdChooser"]),c.trigger(e.AD_DEBUG)):DebuggerJS.off()},this.adBreakInProgress=function(){return this._adBreakInProgress?!0:!1},this.getMaximumAdBreakLengthInSeconds=function(){return o},this.getSettings=function(){return{source:r,debug:m}},this.pause=function(){this._audioAdManager?this._audioAdManager.pause():a.pause()},this.resume=function(){this._audioAdManager?this._audioAdManager.resume():a.resume()},this.lookup=function(a,b,c){this.adChooser&&this.adChooser.lookup(a,b,c)},this.setOverrideTargetingData=function(a,b){return this._laser?(this._laser.setOverrideData(a,b),!0):!1}};b.exports=m},"src/namespace.js":function(a,b,c,d,e,f){Spotify.Ads={},Spotify.Ads.Core=a("src/core.js"),Spotify.Ads.InventoryType=a("src/inventorytype.js").InventoryType,Spotify.Ads.InventoryTypeById=a("src/inventorytype.js").InventoryTypeById,Spotify.Ads.SourceType=a("src/sourcetype.js")},"src/builder.js":function(a,b,c,d,e,f){a("src/namespace.js");var g,h,i=a("src/core.js"),j=a("src/legacy/adchooser.js"),k=a("src/responder.js"),l=a("src/reactor.js"),m=a("src/audioadmanager.js"),n=a("src/sourcetype.js"),o=a("src/laser.js"),p=a("src/utils.js"),q=a("src/protobufschemas.js");Spotify.Shuttle.onReady(function(a,b){"use strict";var c=p.logger("Spotify.Ads.Builder");for(var d in q)q.hasOwnProperty(d)&&(c("adding schema: "+d),a.protobufSchemasManager?a.protobufSchemasManager.registerSchema(d,q[d]):Spotify.Protobuf&&Spotify.Protobuf.Schemas&&(c("warning: registering schema directly on Spotify.Protobuf.Schemas: "+d),Spotify.Protobuf.Schemas[d]=q[d]));b.classes&&(b.classes.Responder&&(g=b.classes.Responder.build(k.proto),g.getInstance().init(),k.fulfill(g)),b.classes.Reactor&&(h=new b.classes.Reactor(l.proto),l.fulfill(h)));var e=b.contextPlayer,f=b.dispatcher,r=b.mediator,s=a.audioManager,t=a.user,u=a.logging.logger;h&&new h(r,f);var v=new Spotify.Events;a.registerService("adChooser",[],["ad-hermes-proxy"],j),a.registerService("adsCore",[],["lasertag"],i),a.adsCore=a.services.adsCore,c("DFP flag is enabled"),a.adsCore.setSource(n.DFP);var w=new m,x=new o(a.metadata);a.adsCore.initialize(a,s,t,u,w,x),a.adsCore.onReady(function(){f.create("/resources/adchooser",null,{adChooser:a.adsCore})}),a.adsCore.adChooser&&(a.adChooser=a.adsCore.adChooser,a.adChooser.bind(v.INTERCEPTED,function(){a.trigger(v.WAIT_FOR_COMMERCIAL_TO_FINISH)}),a.bind(v.RECORD_AD_EVENT,function(b){a.adChooser.onReady(function(){a.adChooser.recordAdEvent(b.params.adUri,b.params.type)})}),a.adChooser.setBannerEnabled(!0)),a.adsCore.initializeContext(e),a.adChooser.initializeContext(e),Spotify.Web&&Spotify.Web.Debugger&&Spotify.Web.Debugger.store("ads","core",a.adsCore)})}});